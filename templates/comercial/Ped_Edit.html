{% extends 'base/base_comercial.html' %}

{% block title %} Graba Pedidos {% endblock title %}</title>
			{% block context%}
			<div class="crea_content">
				<h3 class="crea_proceso">Comercial:  Facturaci√≥n</h3>
				<a class="icon-reply crea_boton" href="{% url 'comercial:fac_panel' %}">Volver</a>
			</div>
			<div>
				<form name="form_pedidos" method="POST" enctype="multipart">{% csrf_token %}
					<div class="form_content">
						<div>
							<div class="form_titulo"><h1> Actualizar Pedidos </h1></div>

							{% if form.errors %}

								<div class="form_errors" role="alert">
									{{ form.errors }}
								</div>

							{% endif %}

							{% for field in form %}
								{% for error in field.errors %}
									<strong>{{ field.label }}</strong>: {{ error }}<br>
								{% endfor %}
							{% endfor %}

							{% for error in form.non_field_errors %}
								<strong>{{ error }}</strong>
							{% endfor %}


							{% if nuevo_mov.errors %}

								<div class="form_errors" role="alert">
									{{ nuevo_mov.errors }}
								</div>

							{% endif %}

							{% for field in nuevo_mov %}
								{% for error in field.errors %}
									<strong>{{ field.label }}</strong>: {{ error }}<br>
								{% endfor %}
							{% endfor %}

							{% for error in nuevo_mov.non_field_errors %}
								<strong>{{ error }}</strong>
							{% endfor %}




							<div class="form_esc">
								<a class="icon-cancel" href="{% url 'comercial:fac_panel' %}"></a>
							</div>
						</div>
						{% comment %}
						<td class="columns_tab width_010"> <input name="mvi_product" required id="cod_product" onclick="popsaldo()" onblur="poptallas()"/></td>
						<div class="form_row"><div class="form_label"><label for="{{form.mvi_motivos.name}}">{{form.mvi_motivos.label}}</label></div><div>{{form.mvi_motivos}}</div></div>
						{% endcomment %}
						<div>
							<fieldset>
								<div class="form_row_all">
									<div class="width_010"><label for="{{form.ped_cliente.name}}">{{form.ped_cliente.label}}</label></div>
									<div class="form_widget width_025">{{ form.ped_cliente }}</div>
									<div class="width_040">&nbsp;</div>
									<div class="width_015"><label for="{{form.ped_fechped.name}}">{{form.ped_fechped.label}}</label></div>
									<div class="form_widget width_010">{{ form.ped_fechped }} </div>
								</div >
								<div class="form_row_all">
									<div class="width_010"><label for="{{form.ped_vendedo.name}}">{{ form.ped_vendedo.label }}</label></div>
									<div class="form_widget width_025">{{ form.ped_vendedo }} </div>
									<div class="width_040">&nbsp;</div>
									<div class="width_015"><label for="{{form.ped_npedido.name}}">{{form.ped_npedido.label}}</label></div>
									<div class="form_widget width_010">{{ form.ped_npedido }}</div>
								</div>
							</fieldset>
						</div>
						<div>
							<table border="0" class="width_100">
								<thead border="1">
								 	<tr color="#:000066">
								 		<th class="head_tab width_015">Producto</th>
								 		<th class="head_tab width_040">Detalle del producto</th>
								 		<th class="head_tab width_010">Cantidad</th>
								 		<th class="head_tab width_005">Und.</th>
								 		<th class="head_tab width_010">Precio</th>
								 		<th class="head_tab width_005">Dscto.</th>
								 		<th class="head_tab width_005">IVA</th>
								 		<th class="head_tab width_010">Valor</th>
								 	</tr>
								</thead>
								<tbody border="1" id="movimientos">
									{% for movimiento in movimientos %}
										<tr >
											<td class="columns_tab width_015"> <input value="{{ movimiento.mvi_product.exs_product }}" disabled="disabled"/></td>
											<td class="columns_tab width_040"> <input value="{{ movimiento.mvi_product.exs_detalle }}" disabled="disabled"></td>
											<td class="columns_tab width_010"> <input value='{{ movimiento.mvi_kntidad|default:0|stringformat:"0.2f" }}' disabled="disabled"/></td>
											<td class="columns_tab width_005"> <input value="{{ movimiento.pop_pedUnid }}" disabled="disabled"></td>
											<td class="columns_tab width_010"> <input class="align_tex_right" disabled="disabled"></td>
											<td class="columns_tab width_005"> <input class="align_tex_right" disabled="disabled"></td>
											<td class="columns_tab width_005"> <input class="align_tex_right" disabled="disabled"></td>
											<td class="columns_tab width_010"> <input class="align_tex_right" disabled="disabled"></td>
										</tr>
									{% endfor %}
									<tr>
										pk=<input name="pop_pedKyPr" type="text" id="inp_pedKyPr" value=" ">
										tab=<input name="pop_pedTbtl" type="text" id="tabtallas" value="0">

										<input name="mvi_talla01" type="number">
										<input name="mvi_talla02" type="number">
										<input name="mvi_talla03" type="number">
										<input name="mvi_talla04" type="number">
										<input name="mvi_talla05" type="number">
										<input name="mvi_talla06" type="number">
										<input name="mvi_talla07" type="number">
										<input name="mvi_talla08" type="number">
										<input name="mvi_talla09" type="number">
										<input name="mvi_talla10" type="number">
										<input name="mvi_talla11" type="number">
										<input name="mvi_talla12" type="number">
										<input name="mvi_talla13" type="number">
									</tr>
									<tr id="templates">

										<td class="columns_tab width_015"> <input name="mvi_product" required id="inp_product"/></td>
										<td class="columns_tab width_040"> <input name="pop_pedDtll" disabled="disabled"></td>
										<td class="columns_tab width_010"> <input name="mvi_kntidad" id="inp_kntidad" type="number" step="0.01" pattern="[0-9]" onChange="verificar()" /></td>
										<td class="columns_tab width_005"> <input name="pop_pedUnid" disabled="disabled"></td>
										<td class="columns_tab width_010"> <input class="align_tex_right" name="pop_pedPrc4" disabled="disabled"></td>
										<td class="columns_tab width_005"> <input class="align_tex_right" name="pop_dscuent" disabled="disabled"></td>
										<td class="columns_tab width_005"> <input class="align_tex_right" name="pop_impuest" disabled="disabled"></td>
										<td class="columns_tab width_010"> <input class="align_tex_right" name="pop_valores" type="number" step="0.01" disabled="disabled"></td>
									</tr>
								</tbody>
								<tr>
								</tr>
								<tr>
									<td class="columns_tab">{{form.fac_cajeras.label}}</td>
									<td class="columns_tab align_tex_right"><label>Total de Itms </label>
									<td class="columns_tab">{{ form.fac_cajeras }} </td>
									<td class="columns_tab">{{ form.totpago }} </td>
									<td class="columns_tab" colspan="2"></td>
									<td class="columns_tab align_tex_right"><label>Totala a pagar</labed>
									<td class="columns_tab">{{ form.grantotal }} </td>
								</tr>
								<tr>
								</tr>
							</table>
						</div>
						<br>


						<div ><button class="icon-database form_submit" type="submit">  Guardar  </button></div>
						<br>
					</div>
				</form>
			</div>
		{% endblock context%}

		{% block js %}

			<script type="text/javascript" >

				var pop_callprd = document.getElementById("inp_product");
					pop_callprd.addEventListener("click", function(){
					document.form_pedidos['mvi_kntidad'].readOnly = false;
					window.open("{% url 'comercial:pop_exist' %}", "prd_winpops", "directories=no,menubar=no,status=no,toolbar=no,location=no,scrollbars=no,fullscreen=no,height=520,width=1180,left=210,top=200")}, false);

				var inp_keyprod = 0;
				var pop_calltll = document.getElementById("inp_kntidad");
					pop_calltll.addEventListener("click", function(){
						var inp_keyprod = document.form_pedidos['pop_pedKyPr'].value;
						var inp_tabtlla = document.form_pedidos['pop_pedTbtl'].value;
						if (inp_tabtlla != "X"){
							document.form_pedidos['mvi_kntidad'].readOnly = true;
							console.log("inp_keyprod:", inp_keyprod);
							var url = "{% url 'inventarios:pop_talla' pk=987654321 %}".replace('987654321', inp_keyprod);

							window.open(url, "pop_dtallas", "directories=no,menubar=no,status=no,toolbar=no,location=no,scrollbars=no,fullscreen=no,height=200,width=920,left=380,top=450");
						} else {
							alert("Este producto no tiene tallas");
						}
					}, false);

				function verificar(){
					inp_tabtlla = document.form_pedidos['pop_pedTbtl'].value;
					if (inp_tabtlla != "X"){
						alert("Este producto tiene tallas");
						document.form_pedidos['mvi_kntidad'].value = 0.00;
						document.form_pedidos['mvi_kntidad'].readOnly = true;
						window.open("{% url 'inventarios:pop_talla' pk=7 %}", "pop_dtallas", "directories=no,menubar=no,status=no,toolbar=no,location=no,scrollbars=no,fullscreen=no,height=200,width=920,left=380,top=450");
					};
				};
			</script>
		{% endblock js %}

